server {
  listen 80;
  server_name ${MATRIX_BASEURL};

  location ~* ^(\/_matrix|\/_synapse\/client) {
    proxy_pass http://matrix-synapse:8008;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    client_max_body_size 25M;
  }

  location /_matrix/client/r0/account/deactivate {
    return 403 '{"errcode": "M_FORBIDDEN","error": "Forbidden"}';
  }

  location /_matrix/client/r0/account/password {
    return 403 '{"errcode": "M_FORBIDDEN","error": "Forbidden"}';
  }
}
